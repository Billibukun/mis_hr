{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Update Employee Profile{% endblock %}

{% block content %}
<div class="container mx-auto mt-8 p-6 bg-white shadow-md rounded-lg">
    <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Update Employee Profile</h2>

    <form method="post" enctype="multipart/form-data" class="max-w-3xl mx-auto space-y-6">
        {% csrf_token %}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-4">
            {{ form.profile_picture|as_crispy_field }}
            {{ form.file_number|as_crispy_field }}
            {{ form.ippis_number|as_crispy_field }}
            {{ form.current_employee_type|as_crispy_field }}
            {{ form.first_name|as_crispy_field }}
            {{ form.middle_name|as_crispy_field }}
            {{ form.last_name|as_crispy_field }}
            {{ form.sex|as_crispy_field }}
            {{ form.marital_status|as_crispy_field }}
            {{ form.date_of_birth|as_crispy_field }}
            {{ form.phone_number|as_crispy_field }}
            {{ form.nin|as_crispy_field }}
        </div>

        <div class="mb-4">
            {{ form.contact_address|as_crispy_field }}
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-4">
            <div>
                {{ form.state_of_origin|as_crispy_field }}
            </div>
            <div>
                {{ form.lga_of_origin|as_crispy_field }}
            </div>
            <div>
                {{ form.state_of_residence|as_crispy_field }}
            </div>
            <div>
                {{ form.lga_of_residence|as_crispy_field }}
            </div>
        </div>

        <div class="border-t border-gray-200 pt-6 mt-8">
            <h3 class="text-lg font-semibold mb-4 text-gray-800">Employment Details</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-4">
                {{ form.date_of_appointment|as_crispy_field }}
                {{ form.date_of_assumption|as_crispy_field }}
                {{ form.date_of_documentation|as_crispy_field }}
                {{ form.date_of_confirmation|as_crispy_field }}
                {{ form.date_of_retirement|as_crispy_field }}
                {{ form.current_department|as_crispy_field }}
                {{ form.current_unit|as_crispy_field }}
                {{ form.current_designation|as_crispy_field }}
                {{ form.current_zone|as_crispy_field }}
                {{ form.current_state|as_crispy_field }}
                {{ form.current_cadre|as_crispy_field }}
                {{ form.current_grade_level|as_crispy_field }}
                {{ form.current_step|as_crispy_field }}
                {{ form.last_promotion_date|as_crispy_field }}
                {{ form.last_examination_date|as_crispy_field }}
            </div>
        </div>

        <div class="mb-4">
            {{ form.is_profile_completed|as_crispy_field }}
        </div>

        <div class="mt-6 text-center">
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300">
                Update Profile
            </button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const stateOfOriginSelect = document.getElementById('id_state_of_origin');
        const lgaOfOriginSelect = document.getElementById('id_lga_of_origin');
        const allLgas = JSON.parse('{{ all_lgas_json|escapejs }}'); // Get all LGAs from context

        function updateLgaOptions() {
            console.log("updateLgaOptions() function called!"); // Check if function is running
            const selectedStateId = stateOfOriginSelect.value;
            console.log("Selected State ID:", selectedStateId); // Check selected state value
            lgaOfOriginSelect.innerHTML = '<option value="">---------</option>'; // Clear options
            if (selectedStateId) {
                const filteredLgas = allLgas.filter(lga => lga.state_id === parseInt(selectedStateId));
                console.log("Filtered LGAs:", filteredLgas); // Check the filtered LGAs array
                filteredLgas.forEach(lga => {
                    const option = document.createElement('option');
                    option.value = lga.id;
                    option.textContent = lga.name;
                    lgaOfOriginSelect.appendChild(option);
                });
            } else {
                console.log("No State selected, LGAs cleared."); // Check if no state selected
            }
        }

        stateOfOriginSelect.addEventListener('change', updateLgaOptions);

        // Initial population of LGA options (optional - if you want LGAs to be filtered on initial load if a state is pre-selected)
        updateLgaOptions();
    });
</script>

{% endblock %}