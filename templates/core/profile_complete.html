{% extends "base.html" %}
{% load static %}

{% block title %}Complete Your Profile - NDE HR Management System{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="mb-6 text-center">
            <img src="{% static 'img/nde_logo.png' %}" alt="NDE Logo" class="mx-auto h-16 mb-2">
            <h1 class="text-2xl font-bold text-nde-black">Complete Your Profile</h1>
            <p class="text-nde-gray">Please provide your personal and professional information to complete your profile.</p>
        </div>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-blue-700">
                        All information provided will be verified by the HR department. Please ensure accuracy.
                    </p>
                </div>
            </div>
        </div>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Personal Information Section -->
            <div class="mb-6">
                <h2 class="text-lg font-medium text-nde-black border-b border-gray-200 pb-2 mb-4">Personal Information</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-group">
                        <label for="{{ form.first_name.id_for_label }}" class="form-label">First Name <span class="text-nde-red">*</span></label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.first_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.middle_name.id_for_label }}" class="form-label">Middle Name</label>
                        {{ form.middle_name }}
                        {% if form.middle_name.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.middle_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.last_name.id_for_label }}" class="form-label">Last Name <span class="text-nde-red">*</span></label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.last_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-group">
                        <label for="{{ form.email.id_for_label }}" class="form-label">Email <span class="text-nde-red">*</span></label>
                        {{ form.email }}
                        {% if form.email.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.email.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.sex.id_for_label }}" class="form-label">Sex <span class="text-nde-red">*</span></label>
                        {{ form.sex }}
                        {% if form.sex.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.sex.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.marital_status.id_for_label }}" class="form-label">Marital Status <span class="text-nde-red">*</span></label>
                        {{ form.marital_status }}
                        {% if form.marital_status.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.marital_status.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-group">
                        <label for="{{ form.date_of_birth.id_for_label }}" class="form-label">Date of Birth <span class="text-nde-red">*</span></label>
                        {{ form.date_of_birth }}
                        {% if form.date_of_birth.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.date_of_birth.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.phone_number.id_for_label }}" class="form-label">Phone Number <span class="text-nde-red">*</span></label>
                        {{ form.phone_number }}
                        {% if form.phone_number.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.phone_number.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.profile_picture.id_for_label }}" class="form-label">Profile Picture</label>
                        {{ form.profile_picture }}
                        <p class="text-xs text-gray-500 mt-1">Upload a passport photograph (max 20KB)</p>
                        {% if form.profile_picture.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.profile_picture.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.contact_address.id_for_label }}" class="form-label">Contact Address <span class="text-nde-red">*</span></label>
                    {{ form.contact_address }}
                    {% if form.contact_address.errors %}
                    <p class="text-nde-red text-xs mt-1">{{ form.contact_address.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Geographic Information Section -->
            <div class="mb-6">
                <h2 class="text-lg font-medium text-nde-black border-b border-gray-200 pb-2 mb-4">Geographic Information</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="{{ form.state_of_residence.id_for_label }}" class="form-label">State of Residence <span class="text-nde-red">*</span></label>
                        {{ form.state_of_residence }}
                        {% if form.state_of_residence.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.state_of_residence.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.lga_of_residence.id_for_label }}" class="form-label">LGA of Residence <span class="text-nde-red">*</span></label>
                        {{ form.lga_of_residence }}
                        {% if form.lga_of_residence.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.lga_of_residence.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="{{ form.state_of_origin.id_for_label }}" class="form-label">State of Origin <span class="text-nde-red">*</span></label>
                        {{ form.state_of_origin }}
                        {% if form.state_of_origin.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.state_of_origin.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.lga_of_origin.id_for_label }}" class="form-label">LGA of Origin <span class="text-nde-red">*</span></label>
                        {{ form.lga_of_origin }}
                        {% if form.lga_of_origin.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.lga_of_origin.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- ID Information Section -->
            <div class="mb-6">
                <h2 class="text-lg font-medium text-nde-black border-b border-gray-200 pb-2 mb-4">Identification Information</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="{{ form.nin.id_for_label }}" class="form-label">National Identification Number (NIN)</label>
                        {{ form.nin }}
                        <p class="text-xs text-gray-500 mt-1">11-digit number without spaces</p>
                        {% if form.nin.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.nin.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.brn.id_for_label }}" class="form-label">Birth Registration Number (BRN)</label>
                        {{ form.brn }}
                        {% if form.brn.errors %}
                        <p class="text-nde-red text-xs mt-1">{{ form.brn.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button type="submit" class="btn-primary px-8">Submit Profile</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Dynamic LGA loading for state of residence
    document.getElementById('{{ form.state_of_residence.id_for_label }}').addEventListener('change', function() {
        const stateId = this.value;
        if (stateId) {
            fetch(`/ajax/lgas/?state_id=${stateId}`)
                .then(response => response.json())
                .then(data => {
                    const lgaSelect = document.getElementById('{{ form.lga_of_residence.id_for_label }}');
                    lgaSelect.innerHTML = '<option value="">Select LGA of Residence</option>';
                    
                    data.lgas.forEach(lga => {
                        const option = document.createElement('option');
                        option.value = lga.id;
                        option.textContent = lga.name;
                        lgaSelect.appendChild(option);
                    });
                });
        }
    });
    
    // Dynamic LGA loading for state of origin
    document.getElementById('{{ form.state_of_origin.id_for_label }}').addEventListener('change', function() {
        const stateId = this.value;
        if (stateId) {
            fetch(`/ajax/lgas/?state_id=${stateId}`)
                .then(response => response.json())
                .then(data => {
                    const lgaSelect = document.getElementById('{{ form.lga_of_origin.id_for_label }}');
                    lgaSelect.innerHTML = '<option value="">Select LGA of Origin</option>';
                    
                    data.lgas.forEach(lga => {
                        const option = document.createElement('option');
                        option.value = lga.id;
                        option.textContent = lga.name;
                        lgaSelect.appendChild(option);
                    });
                });
        }
    });
</script>
{% endblock %}